---
import Layout from "../layouts/Layout.astro";
import { getDatabases } from "../db";

const databases = getDatabases().sort((a, b) => b.localeCompare(a)); // Sort latest first
---

<Layout title="Select Backup | Kobo Annotations">
    <h1>Kobo Annotations</h1>
    <p style="color: var(--text-secondary); margin-bottom: 2rem;">
        Select a backup database to view its annotations.
    </p>

    <div class="grid">
        {
            databases.length > 0 ? (
                databases.map((db) => (
                    <a href={`/${db}/`} class="card">
                        <h2 style="font-size: 1.25rem;">{db}</h2>
                        <p style="color: var(--text-secondary);">Kobo backup</p>
                    </a>
                ))
            ) : (
                <div
                    class="card"
                    style="grid-column: 1 / -1; text-align: center; padding: 3rem;"
                >
                    <p>
                        No databases found in <code>data/</code> folder.
                    </p>
                    <p style="font-size: 0.875rem; color: var(--text-secondary);">
                        Each backup should be in its own folder inside{" "}
                        <code>data/</code>, containing{" "}
                        <code>KoboReader.sqlite</code> and a{" "}
                        <code>markups/</code> folder.
                    </p>
                </div>
            )
        }
    </div>
</Layout>

<style>
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 0.75rem;
    }
    a.card {
        display: block;
        text-decoration: none;
        color: inherit;
        transition:
            transform 0.2s ease,
            border-color 0.2s ease;
    }
    a.card:hover {
        transform: translateY(-2px);
        border-color: var(--accent);
    }
</style>
